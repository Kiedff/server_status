= link_to "Edit event", edit_event_path(@event) if can? :edit, Event
= link_to "Add comment", new_event_comment_path(@event) if can? :create, Comment

.status{ style: "background-color: #{@event.status.colour}"}
  = @event.status.name

.event

  %h2 #{@event.title}

  - if @event.resolved_at 
    %p Resolved at #{@event.resolved_at}

  - else
    - if @event.created_at != @event.updated_at
      %p Updated at: 
      %p #{@event.updated_at}

  = @event.content
  %br
  %br
  
  .comments
    - if @event.comments != []
      %h2 latest update

      - comment = @event.comments.first

      - if comment.updated_at
        %p Updated at #{comment.updated_at}

      - else
        %p Updated at #{comment.created_at}

      %p #{comment.body}
      = link_to "Edit", edit_event_comment_path(@event, comment) if can? :edit, Comment

    - if @event.comments.length > 1
      %h2 Previous updates

      .comment
        - @event.comments.drop(1).each do |comment|
          - if comment.updated_at
            %p Updated at #{comment.updated_at}
            
          - else
            %p Updated at #{comment.created_at}

          %p #{comment.body}
          = link_to "Edit", edit_event_comment_path(@event, comment)
          = link_to "Delete", event_comment_path(@event, comment), method: :delete, data: { confirm: 'Are you sure?'}

